pool:
  vmImage: 'windows-2022'

trigger:
  batch: true
  branches:
    include:
    - '*'

variables:
- name: VCPKG_BINARY_SOURCES
  value: 'clear;nuget,https://pkgs.dev.azure.com/TranslucentTB/TranslucentTB/_packaging/VcpkgCache/nuget/v3/index.json,readwrite'
- group: Trusted Signing

strategy:
  matrix:
    'ARM64 Debug':
      configuration: Debug
      platform: ARM64
    'ARM64 Release':
      configuration: Release
      platform: ARM64
    'x64 Debug':
      configuration: Debug
      platform: x64
    'x64 Release':
      configuration: Release
      platform: x64

steps:
- template: templates/build.yml
  parameters:
    platform: $(platform)
    configuration: $(configuration)
    buildType: Canary
    extraMsbuildArgs: '/p:AppxPackageSigningEnabled=True /p:AzureCodeSigningEnabled=True /p:AzureCodeSigningEndpoint=$(trustedSigningEndpoint) /p:AzureCodeSigningAccountName=$(trustedSigningAccountName) /p:AzureCodeSigningCertificateProfileName=$(trustedSigningCertificateProfileName)'
- template: templates/upload.yml
  parameters:
    platform: $(platform)
    configuration: $(configuration)
